<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making 2D Hilbert Curve • HilbertCurve</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Making 2D Hilbert Curve">
<meta property="og:description" content="HilbertCurve">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HilbertCurve</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Vignettes</li>
    <li>
      <a href="../articles/hc_general.html">Making 2D Hilbert Curve</a>
    </li>
    <li>
      <a href="../articles/hc_genome.html">GenomicHilbertCurve: specific for genomic data</a>
    </li>
    <li>
      <a href="../articles/cpan.html">Visualize CPAN modules with Hilbert curve</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/HilbertCurve/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Making 2D Hilbert Curve</h1>
                        <h4 data-toc-skip class="author">Zuguang Gu (<a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a>)</h4>
            
            <h4 data-toc-skip class="date">2024-09-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/HilbertCurve/blob/HEAD/vignettes/hc_general.Rmd" class="external-link"><code>vignettes/hc_general.Rmd</code></a></small>
      <div class="hidden name"><code>hc_general.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Hilbert_curve" class="external-link">Hilbert curve</a> is a type of space-filling curves that folds one dimensional axis into a two dimensional space, but still keeps the locality. It has advantages to visualize data with long axis in following two aspects:</p>
<ol style="list-style-type: decimal">
<li>greatly improve resolution of the visualization fron <span class="math inline">\(n\)</span> to <span class="math inline">\(\sqrt{n}\)</span>;</li>
<li>easy to visualize clusters because generally data points in the axis will also be close in the 2D space.</li>
</ol>
<p>This package aims to provide an easy and flexible way to visualize data through Hilbert curve. The implementation and example figures are based on following sources:</p>
<ul>
<li><a href="http://mkweb.bcgsc.ca/hilbert/" class="external-link uri">http://mkweb.bcgsc.ca/hilbert/</a></li>
<li><a href="http://corte.si/posts/code/hilbert/portrait/index.html" class="external-link uri">http://corte.si/posts/code/hilbert/portrait/index.html</a></li>
<li><a href="http://bioconductor.org/packages/devel/bioc/html/HilbertVis.html" class="external-link uri">http://bioconductor.org/packages/devel/bioc/html/HilbertVis.html</a></li>
</ul>
<p>We first load the packages and set seed for random numbers.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/HilbertCurve" class="external-link">HilbertCurve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize" class="external-link">circlize</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<p>Following plots show Hilbert curves with level 2, 3, 4, 5:</p>
<p><img src="hc_general_files/figure-html/unnamed-chunk-3-1.png" width="1152" style="display: block; margin: auto;"></p>
<p>As shown in the above plots, as level increases, the length of the curve becomes longer and the curve folds more densely. The number of segments (one segment is marked in red) on the Hilbert curve is <code>4^level - 1</code>. If a Hilbert curve with level 11 is used to map to human chromosome 1, the resolution would be <code>249250621/4^11</code> (approximately 59bp per segment).</p>
<div class="section level3">
<h3 id="locality">Locality<a class="anchor" aria-label="anchor" href="#locality"></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/Hilbert_curve" class="external-link">Hilbert curve</a> folds one-dimensional axis into a two-dimensional space while still preserves the locality of the data points. We visualize this attribute with a Hilbert curve with level 5. In following animation, the point moves with its natural order on the axis.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1024</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1024</span>, level <span class="op">=</span> <span class="fl">5</span>, reference <span class="op">=</span> <span class="cn">TRUE</span>, arrow <span class="op">=</span> <span class="cn">FALSE</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">i</span>, np <span class="op">=</span> <span class="cn">NULL</span>, pch <span class="op">=</span> <span class="fl">16</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>
<video controls loop><source src="move-on-hilbert-curve-.webm"></source></video></p>
<p>Next, we calculate the pairwise distance between data points in the 2D space and visualize it as heatmap. The numbers on x-axis (top) and y-axis (left) illustrate the position of data points in the original 1D axis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.ebi.ac.uk/~anders/hilbert" class="external-link">HilbertVis</a></span><span class="op">)</span></span>
<span><span class="va">pos</span> <span class="op">=</span> <span class="fu">HilbertVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HilbertVis/man/hilbertCurve.html" class="external-link">hilbertCurve</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap" class="external-link">ComplexHeatmap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">Heatmap</a></span><span class="op">(</span><span class="va">mat</span>, name <span class="op">=</span> <span class="st">"dist"</span>, cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, cluster_columns <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, show_column_names <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"euclidean_dist"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span><span class="va">ht</span>, padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/decorate_heatmap_body.html" class="external-link">decorate_heatmap_body</a></span><span class="op">(</span><span class="st">"dist"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.segments.html" class="external-link">grid.segments</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">256</span>, <span class="fl">512</span>, <span class="fl">768</span>, <span class="fl">1024</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">256</span>, <span class="fl">512</span>, <span class="fl">768</span><span class="op">)</span><span class="op">/</span><span class="fl">1024</span>, just <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>        rot <span class="op">=</span> <span class="fl">90</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">256</span>, <span class="fl">512</span>, <span class="fl">768</span>, <span class="fl">1024</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">256</span>, <span class="fl">512</span>, <span class="fl">768</span>, <span class="fl">1024</span><span class="op">)</span><span class="op">/</span><span class="fl">1024</span>, <span class="fl">1</span>, just <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Basically, from the heatmap, data points which are close in the 1D axis are still close in the 2D space (illustrated in the areas around diagonals).</p>
<p>Also there are some data points in (e.g, 1 ~ 256) which are close to data points in (768 ~ 1024)(bottom left or top right area in the heatmap), but it is only due to that the curve folds back. This exception can be easily distinguished by adding assistant grid lines or if users are clear with the structure of the curve.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-settings">Basic settings<a class="anchor" aria-label="anchor" href="#basic-settings"></a>
</h2>
<p>The <strong>HilbertCurve</strong> package provides a rather simple way to display the data in the form of Hilbert curve. It hides all the technical parts and users only need to think that they are adding graphics on a novel axis based on specifying positions.</p>
<p>Generally, customizing a Hilbert curve follows following steps:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>    <span class="co"># initialize the curve</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">...</span><span class="op">)</span>        <span class="co"># add points </span></span>
<span><span class="fu"><a href="../reference/hc_rect-dispatch.html">hc_rect</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">...</span><span class="op">)</span>          <span class="co"># add rectangles</span></span>
<span><span class="fu"><a href="../reference/hc_polygon-dispatch.html">hc_polygon</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">...</span><span class="op">)</span>       <span class="co"># add polygons</span></span>
<span><span class="fu"><a href="../reference/hc_segments-dispatch.html">hc_segments</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">...</span><span class="op">)</span>      <span class="co"># add lines</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">...</span><span class="op">)</span>          <span class="co"># add text</span></span></code></pre></div>
<p><code><a href="../reference/HilbertCurve.html">HilbertCurve()</a></code> is a constructor function and initializes the Hilbert curve. Following example means initializing a Hilbert curve with level 4 which maps data ranging from 1 to 100. The function returns a <code>HilbertCurve</code> class instance and it can be used to add more graphics later.</p>
<p><code>reference</code> argument here is only used to show the structure of the curve.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>By default, the Hilbert curve starts from the bottom left corner. The start position can be specifyed by <code>start_from</code> option and the orientation of the first segment can be set by <code>first_seg</code>:</p>
<p><img src="hc_general_files/figure-html/unnamed-chunk-8-1.png" width="1152" style="display: block; margin: auto;"></p>
<p>The curve can be though as a folded axis. When the coordinate for this folded axis is initialized, low-level graphics can be added by specifying the positions.</p>
<p>There are several ways to specify the “positions” of the data points. The most common way is to construct a <code>IRanges</code> object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/IRanges" class="external-link">IRanges</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">*</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">e</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">*</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">ir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/IRanges-constructor.html" class="external-link">IRanges</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">e</span><span class="op">)</span></span>
<span><span class="va">ir</span></span></code></pre></div>
<pre><code><span><span class="co">## IRanges object with 10 ranges and 0 metadata columns:</span></span>
<span><span class="co">##            start       end     width</span></span>
<span><span class="co">##        &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span></span>
<span><span class="co">##    [1]         2        10         9</span></span>
<span><span class="co">##    [2]        14        24        11</span></span>
<span><span class="co">##    [3]        32        38         7</span></span>
<span><span class="co">##    [4]        39        40         2</span></span>
<span><span class="co">##    [5]        51        58         8</span></span>
<span><span class="co">##    [6]        75        80         6</span></span>
<span><span class="co">##    [7]        81        86         6</span></span>
<span><span class="co">##    [8]        87        88         2</span></span>
<span><span class="co">##    [9]        90        92         3</span></span>
<span><span class="co">##   [10]        93        96         4</span></span></code></pre>
<p>Here <code>ir</code> contains intervals which are composed by integers. In <a href="#toc_10">later sections</a>, you will see it is also possible to specify positions with numeric values and very large values.</p>
<div class="section level3">
<h3 id="points">Points<a class="anchor" aria-label="anchor" href="#points"></a>
</h3>
<p>There are two modes for adding points. Normally, intervals are always long in the curve and can not be sufficiently represented by single points, thus, by default, a list of e.g. circles compose the intervals.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The number of circles used to represent the intervals can be controlled by <code>np</code> (number of points per segment). <code>np</code> controls number of tiny segments that split every Hilbert curve segment (e.g. the first horizontal segment in the left bottom in the curve). Following plot is under <code>np = 3</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span>, level <span class="op">=</span> <span class="fl">2</span>, reference <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"np = 3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fl">1</span>, x2 <span class="op">=</span> <span class="fl">2</span>, np <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-11-1.png" width="288" style="display: block; margin: auto;"></p>
<p>Graphic parameters can be set by <code>gp</code>. Note under this mode, the size of points can only be controlled by <code>np</code> argument. To make it more interesting, you can choose different shapes for the points. There are some pre-defined shapes that you can choose from: “circle”, “square”, “triangle”, “hexagon”, “star”.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, np <span class="op">=</span> <span class="fl">3</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/rand_color.html" class="external-link">rand_color</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"circle"</span>, <span class="st">"square"</span>, <span class="st">"triangle"</span>, <span class="st">"hexagon"</span>, <span class="st">"star"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In above figure, you may notice for some points, the color is more light in the ends. This is because the segments represented by these light circles are not fully covered by user’s input intervals, thus, averaging is applied here. E.g. if only the half of the segment represented by the circle is covered by user’s interval and the color for this circle is set to red, then after the averaging, the color would be semi-red (<code>#FF8080</code>, an average between red and white). Averaging is very important when you visualize the genome with zooming. You can find more detailed explanation in the <a href="#toc_14"><strong>Averaging</strong></a> section.</p>
<p>If <code>np</code> is set to 1 or <code>NULL</code>, there will be second mode for adding points that the points are plotted at the center of every interval in <code>ir</code>. In this case, <code>size</code> argument is used to control the size of the points. This mode is useful if you have a lot of small intervals.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, np <span class="op">=</span> <span class="cn">NULL</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="segments">Segments<a class="anchor" aria-label="anchor" href="#segments"></a>
</h3>
<p>Adding segments is quite straightforward. You can assign <code>lwd</code> to a large value to simulate long and twisted rectangles.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_segments-dispatch.html">hc_segments</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="rectangles">Rectangles<a class="anchor" aria-label="anchor" href="#rectangles"></a>
</h3>
<p><code><a href="../reference/hc_rect-dispatch.html">hc_rect()</a></code> fills intervals by a list of squares. The squares always locate at the turning points of the Hilbert curve and the width/height cannot be modified and it is automatically adjusted according to the level of the curve.</p>
<p>There is a difference from <code><a href="../reference/hc_points-dispatch.html">hc_points()</a></code> with setting <code>shape</code> to <code>square</code>. The number of squares per segment is always 2 for <code><a href="../reference/hc_rect-dispatch.html">hc_rect()</a></code> while it can be any number for <code><a href="../reference/hc_points-dispatch.html">hc_points()</a></code>. When the interval is long enough, <code><a href="../reference/hc_rect-dispatch.html">hc_rect()</a></code> can completely fill the surrounding areas.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_rect-dispatch.html">hc_rect</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#FF000080"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-15-1.png" width="576" style="display: block; margin: auto;"></p>
<p>As you can see some rectangles are not full red as well. It is also because of averaging. See <a href="#toc_14"><strong>Averaging</strong></a> sections for explanation.</p>
</div>
<div class="section level3">
<h3 id="polygons">Polygons<a class="anchor" aria-label="anchor" href="#polygons"></a>
</h3>
<p>Basically polygons are quite similar to the rectangles. The major difference is 1. borders can be set for irregular polygons; 2. there is only single color in one polygon while for rectangles, the color can change in the ends of the interval if the corresponding segment is not completely covered by the input interval.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_polygon-dispatch.html">hc_polygon</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="text">Text<a class="anchor" aria-label="anchor" href="#text"></a>
</h3>
<p>Text by <code><a href="../reference/hc_text-dispatch.html">hc_text()</a></code> is always added at the center of each interval in <code>ir</code>. Additional settings such as <code>just</code> and <code>rot</code> can also be set.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, labels <span class="op">=</span> <span class="va">labels</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/start.html" class="external-link">width</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">+</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-17-1.png" width="576" style="display: block; margin: auto;"></p>
<p>When the intervals are long or when there are polygons representing the intervals, it is better to put text in the visual center of the polygons. For this, <code>centered_by</code> argument can be set to <code>polygon</code>. Compare postions of <code>a</code> and <code>b</code> in following plot:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_polygon-dispatch.html">hc_polygon</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, labels <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, labels <span class="op">=</span> <span class="st">"b"</span>, centered_by <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This functionality is used to <a href="#toc_22">add chromosome names to the Hilbert curve</a>.</p>
</div>
<div class="section level3">
<h3 id="combine-low-level-functions">Combine low-level functions<a class="anchor" aria-label="anchor" href="#combine-low-level-functions"></a>
</h3>
<p>With combination of these basic low-level graphic functions, complicated graphics can be easily made:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_segments-dispatch.html">hc_segments</a></span><span class="op">(</span><span class="va">hc</span>, <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/IRanges-constructor.html" class="external-link">IRanges</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>   <span class="co"># This is an other way to add background line</span></span>
<span><span class="fu"><a href="../reference/hc_rect-dispatch.html">hc_rect</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/rand_color.html" class="external-link">rand_color</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span>, transparency <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_polygon-dispatch.html">hc_polygon</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, np <span class="op">=</span> <span class="fl">3</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/rand_color.html" class="external-link">rand_color</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"circle"</span>, <span class="st">"square"</span>, <span class="st">"triangle"</span>, <span class="st">"hexagon"</span>, <span class="st">"star"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, labels <span class="op">=</span> <span class="va">labels</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/start.html" class="external-link">width</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">+</span><span class="fl">5</span>, col <span class="op">=</span> <span class="st">"blue"</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-19-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="non-integer-positions">Non-integer positions<a class="anchor" aria-label="anchor" href="#non-integer-positions"></a>
</h2>
<p>It doesn’t matter if your positions are integers or not. Internally, adjustment is automatically applied.</p>
<p>When positions are not integers, you can specify the positions by <code>x1</code> and <code>x2</code>. All low-level graphical funtions accept <code>x1</code> and <code>x2</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.8</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.55</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.65</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This is also useful to specify the positions with huge integers which can not be handled by the <code>IRanges</code> class (e.g. the summation of total length of human chromosomes).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># code not run when generating the vignette</span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000000000000</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fl">400000000000</span>, x2 <span class="op">=</span> <span class="fl">600000000000</span><span class="op">)</span></span></code></pre></div>
<p>Negative positions are allowed as well.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># code not run when generating the vignette</span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">4</span>, reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="op">-</span><span class="fl">50</span>, x2 <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pixel-mode">Pixel mode<a class="anchor" aria-label="anchor" href="#pixel-mode"></a>
</h2>
<p>The pixel mode can be thought as a high resolution version of <code><a href="../reference/hc_rect-dispatch.html">hc_rect()</a></code>. When the level is high (e.g. &gt; 10), the whole 2D space will be almost completely filled by the curve and it is impossible to add or visualize e.g. points on the curve. In this case, the ‘pixel’ mode visualizes each tiny ‘segment’ as a pixel and maps values to colors. Internally, the whole plot is represented as an RGB matrix and every time a new layer is added to the plot, the RGB matrix will be updated according to the color overlay. When all the layers are added, normally a PNG figure is generated directly from the RGB matrix. So the Hilbert curve with level 11 will generate a PNG figure with 2048x2048 resolution. This is extremely useful for visualize genomic data. E.g. If we make a Hilbert curve for human chromosome 1 with level 11, then each pixel can represent 60bp (<code>249250621/2048/2048</code>) which is of very high resolution.</p>
<p>Under ‘pixel’ mode, every time a new layer is added, the image is added to the interactive device as a rastered image.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-23-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Since color is graphic representation to values, there is only one graphic setting <code>col</code>. You can add more than one layers, and just remember to set transparent colors for the additional layers.</p>
<p>To map values to colors, users can try <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2()</a></code> function in <strong>circlize</strong> package to generate a color mapping function. Another advantage of using <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2()</a></code> is it can be used to generate the corresponding color legend.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_fun</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">960</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">=</span> <span class="va">x</span><span class="co"># start of each interval</span></span>
<span><span class="va">x2</span> <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">2</span>    <span class="co"># end of each interval</span></span>
<span><span class="va">value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>  <span class="co"># associated values</span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span>, col <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fl">750</span>, x2 <span class="op">=</span> <span class="fl">850</span>, col <span class="op">=</span> <span class="st">"#00000010"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-24-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Grid lines can be added to the plot for better distinguishing blocks in the Hilbert curve. The 2D space will be split into <code>2^(grid_line-1)</code> rows and <code>2^(grid_line-1)</code> columns.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span>, col <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, grid_line <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-25-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Borders can be added by setting <code>border</code> to <code>TRUE</code> or a vector of colors to distinguish different intervals.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span>, col <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-26-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Setting <code>border</code> argument in <code>hc_layer</code> directly modifies the RGB matrix. It adds one pixel border for each polygon and sometimes the border dispears when compressing the image. It is more suggested to add borders by <code><a href="../reference/hc_polygon-dispatch.html">hc_polygon()</a></code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span>, col <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_polygon-dispatch.html">hc_polygon</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-27-1.png" width="576" style="display: block; margin: auto;"></p>
<p>For the low-level graphic functions introduced before, only <code><a href="../reference/hc_polygon-dispatch.html">hc_polygon()</a></code> and <code><a href="../reference/hc_text-dispatch.html">hc_text()</a></code> can work for pixel mode. E.g. <code><a href="../reference/hc_polygon-dispatch.html">hc_polygon()</a></code> draws partitions and <code><a href="../reference/hc_text-dispatch.html">hc_text()</a></code> adds labels for the partitions.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span>, col <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_polygon-dispatch.html">hc_polygon</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200</span>, <span class="fl">500</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200</span>, <span class="fl">500</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>, </span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, centered_by <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-28-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The Hilbert curve can be save as a PNG figure by <code><a href="../reference/hc_png-HilbertCurve-method.html">hc_png()</a></code> with resolution <code>2^level x 2^level</code>. Note only the curve itself not including the graphics by <code><a href="../reference/hc_polygon-dispatch.html">hc_polygon()</a></code>/<code><a href="../reference/hc_text-dispatch.html">hc_text()</a></code> is exported.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># code not run, only for demonstration</span></span>
<span><span class="fu"><a href="../reference/hc_png-HilbertCurve-method.html">hc_png</a></span><span class="op">(</span><span class="va">hc</span>, file <span class="op">=</span> <span class="st">"test.png"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="color-overlay">Color overlay<a class="anchor" aria-label="anchor" href="#color-overlay"></a>
</h3>
<p>As discussed before, under “pixel” mode, the Hilbert curve is stored in an RGB matrix, every time a new layer is added, the RGB values that correspond to the new input intervals will be updated according to the color and transparency of the new layer.</p>
<p>By default, the color overlay for layers is applied based on the transparency of the new layer. Under “pixel” mode, each pixel is represented by red, green and blue colors for which the value is between 0 and 1. When a new layer with transparency color is added, the overlayed RGB is calculated as follows (<code>r0</code>, <code>g0</code> and <code>b0</code> correspond to the layer which is already added, <code>r</code>, <code>g</code>, <code>b</code> and <code>alpha</code> correspond to the layer which is going to be added). The method is implemented in <code><a href="../reference/default_overlay.html">default_overlay()</a></code> function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">=</span> <span class="va">r</span><span class="op">*</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">r0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">alpha</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">=</span> <span class="va">g</span><span class="op">*</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">g0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">alpha</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">=</span> <span class="va">b</span><span class="op">*</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">b0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">alpha</span><span class="op">)</span></span></code></pre></div>
<p>Insteading of globally controlling the color overlay, <code><a href="../reference/hc_layer-dispatch.html">hc_layer()</a></code> provides an <code>overlay</code> argument for which users can specificly control the color overlay in the regions that the input invervals cover. In following example, we change the red regions which are overlapped with the blue regions to green.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">750</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">850</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#0000FF20"</span>,</span>
<span>    overlay <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">r0</span>, <span class="va">g0</span>, <span class="va">b0</span>, <span class="va">r</span>, <span class="va">g</span>, <span class="va">b</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span> <span class="co"># it's only applied in [300, 400] and [750, 850]</span></span>
<span>        <span class="va">l</span> <span class="op">=</span> <span class="fu"><a href="../reference/is_white.html">is_white</a></span><span class="op">(</span><span class="va">r0</span>, <span class="va">g0</span>, <span class="va">b0</span><span class="op">)</span> <span class="co"># `is_white` simple tests whether it is the white color</span></span>
<span>        </span>
<span>        <span class="co"># change the red background to green</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">!</span><span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">r0</span><span class="op">[</span><span class="op">!</span><span class="va">l</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span> </span>
<span>            <span class="va">g0</span><span class="op">[</span><span class="op">!</span><span class="va">l</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span> </span>
<span>            <span class="va">b0</span><span class="op">[</span><span class="op">!</span><span class="va">l</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span> </span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># overlay #0000FF20 to the background</span></span>
<span>        <span class="fu"><a href="../reference/default_overlay.html">default_overlay</a></span><span class="op">(</span><span class="va">r0</span>, <span class="va">g0</span>, <span class="va">b0</span>, <span class="va">r</span>, <span class="va">g</span>, <span class="va">b</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-31-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The self-defined <code>overlay</code> should accept seven arguments for which, <code>r0</code>, <code>g0</code> and <code>b0</code> correspond to RGB channles for the layers which are already added, <code>r</code>, <code>g</code>, <code>b</code> and <code>alpha</code> correspond to the layer which are going to be added. The elements of i.e. <code>r0</code>, <code>g0</code>, <code>b0</code>, <code>r</code>, <code>g</code>, <code>b</code> only correspond to the pixels that are covered by the intervals in the new layer, and <code>overlay</code> function is applied to every interval in the new layer iteratively.</p>
<p>For <code><a href="../reference/default_overlay.html">default_overlay()</a></code>, if any of <code>r0</code>, <code>g0</code>, <code>b0</code> has <code>NA</code>, the color from the new layer is only used. If any of <code>r</code>, <code>g</code>, <code>b</code> has <code>NA</code>, the color from the background is still used. The overlap of the two-layer colors are only calculated when there are no <code>NA</code> values in the colors.</p>
<p>The color overlay can also be applied to continuous colors. If the color mapping is generated by <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">circlize::colorRamp2()</a></code>, <code><a href="https://rdrr.io/pkg/circlize/man/col2value.html" class="external-link">circlize::col2value()</a></code> function can transform from colors back to the original values (it can be thought as the reversed function of <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2()</a></code>). Since the <code>overlay</code> function only provides color information, we can use <code><a href="https://rdrr.io/pkg/circlize/man/col2value.html" class="external-link">col2value()</a></code> to obtain back the original value and use <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2()</a></code> to generate a new set of colors.</p>
<p>In following plot, we change the color theme in the overlapped areas from “white-red” to “white-blue”. To do this, we first select the non-white pixels, transform back to the original values by <code><a href="https://rdrr.io/pkg/circlize/man/col2value.html" class="external-link">col2value()</a></code> and finally change to another color schema.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span>, col <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">750</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">850</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#00000010"</span>,</span>
<span>    overlay <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">r0</span>, <span class="va">g0</span>, <span class="va">b0</span>, <span class="va">r</span>, <span class="va">g</span>, <span class="va">b</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># non-white pixels</span></span>
<span>        <span class="va">l</span> <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="../reference/is_white.html">is_white</a></span><span class="op">(</span><span class="va">r0</span>, <span class="va">g0</span>, <span class="va">b0</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># these lines will be removed in the next version</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">col_fun</span>, <span class="st">"colors"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">col_fun</span>, <span class="st">"colors"</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">col_fun</span>, <span class="st">"colors"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">255</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># original value</span></span>
<span>        <span class="va">v</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/col2value.html" class="external-link">col2value</a></span><span class="op">(</span><span class="va">r0</span><span class="op">[</span><span class="va">l</span><span class="op">]</span>, <span class="va">g0</span><span class="op">[</span><span class="va">l</span><span class="op">]</span>, <span class="va">b0</span><span class="op">[</span><span class="va">l</span><span class="op">]</span>, col_fun <span class="op">=</span> <span class="va">col_fun</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># new color schema</span></span>
<span>        <span class="va">col_fun_new</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">col_new</span> <span class="op">=</span> <span class="fu">col_fun_new</span><span class="op">(</span><span class="va">v</span>, return_rgb <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="va">r0</span><span class="op">[</span><span class="va">l</span><span class="op">]</span> <span class="op">=</span> <span class="va">col_new</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">g0</span><span class="op">[</span><span class="va">l</span><span class="op">]</span> <span class="op">=</span> <span class="va">col_new</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>        <span class="va">b0</span><span class="op">[</span><span class="va">l</span><span class="op">]</span> <span class="op">=</span> <span class="va">col_new</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span>        <span class="co"># overlay #00000010 to the background</span></span>
<span>        <span class="fu"><a href="../reference/default_overlay.html">default_overlay</a></span><span class="op">(</span><span class="va">r0</span>, <span class="va">g0</span>, <span class="va">b0</span>, <span class="va">r</span>, <span class="va">g</span>, <span class="va">b</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-32-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In above example, actually you can implement such overlay by first splitting the “red” regions into two parts by whether they overlap with the “grey” regions. Then add the not-overlapped regions, the “grey” regions, and overlapped regions as three independent layers.</p>
<pre><code>hc_layer(red regions not ovelap with blue regions, use white-red color schema)
hc_layer(grey regions)
hc_layer(white-blue regions)
</code></pre>
<p>You can see the <code>overlay</code> option provides an easier and more straightforward way to do it.</p>
<p><a href="#toc_20">In later section</a>, we will demonstrate using self-defined overlay method can efficiently visualize the correspondance between H3K36me3 histone mark and gene body.</p>
</div>
</div>
<div class="section level2">
<h2 id="add-title-and-legends">Add title and legends<a class="anchor" aria-label="anchor" href="#add-title-and-legends"></a>
</h2>
<p>Title can be set by the <code>title</code> argument in <code><a href="../reference/HilbertCurve.html">HilbertCurve()</a></code>. Legend can be passed to <code>legend</code> argument in <code><a href="../reference/HilbertCurve.html">HilbertCurve()</a></code> as a <code>grob</code>/<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legends.html" class="external-link">ComplexHeatmap::Legends</a></code> object or a list of these objects. Basically, colors are the main aesthetic mappings to values, thus, <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html" class="external-link">Legend()</a></code> function in <strong>ComplexHeatmap</strong> package can be very helpful to create a legend. Also you can consider <code><a href="https://rdrr.io/r/grid/legendGrob.html" class="external-link">legendGrob()</a></code> in <strong>grid</strong> package.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col_fun</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">legend1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html" class="external-link">Legend</a></span><span class="op">(</span>at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span>
<span><span class="va">legend2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html" class="external-link">Legend</a></span><span class="op">(</span>at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, legend_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#00FF0080"</span>, <span class="st">"#0000FF80"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    title <span class="op">=</span> <span class="st">"discrete"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">legend</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">legend1</span>, <span class="va">legend2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, reference <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"points"</span>, legend <span class="op">=</span> <span class="va">legend</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, np <span class="op">=</span> <span class="fl">3</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_rect-dispatch.html">hc_rect</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">ir</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#00FF0020"</span>, <span class="st">"#0000FF20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-33-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Under “pixel” mode, and when the curve is shown on the interactive device as raster image, title and legends can be added as well. But if the plot is exported by <code><a href="../reference/hc_png-HilbertCurve-method.html">hc_png()</a></code>, there will be not title and no legend.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_fun</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lgd1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html" class="external-link">Legend</a></span><span class="op">(</span>at <span class="op">=</span> <span class="va">breaks</span>, col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"style 1"</span><span class="op">)</span></span>
<span><span class="va">lgd2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html" class="external-link">Legend</a></span><span class="op">(</span>at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span>, legend_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"style 2"</span><span class="op">)</span></span>
<span><span class="va">lgd3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html" class="external-link">Legend</a></span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"style 3"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, level <span class="op">=</span> <span class="fl">9</span>, mode <span class="op">=</span> <span class="st">"pixel"</span>, title <span class="op">=</span> <span class="st">"pixel mode"</span>, </span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lgd1</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">x</span>, x2 <span class="op">=</span> <span class="va">x</span><span class="op">+</span><span class="fl">2</span>, mean_mode <span class="op">=</span> <span class="st">"absolute"</span>, col <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-34-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="averaging-models">Averaging models<a class="anchor" aria-label="anchor" href="#averaging-models"></a>
</h2>
<p><strong>Note: this “averaging” concept is very important. If you have unexpected plot, try other <code>mean_mode</code> option.</strong></p>
<p>When using points or rectangles under “normal” mode, or using pixels under “pixel” mode, each point/rectangle/pixel corresponds to a small interval. When overlapping these intervals to the segments of Hilbert curve, and when the segment on the curve is not fully covered by the input intervals, proper averaging method should be applied to summarize the value in the corresponding segments.</p>
<p>Depending on different scenarios, <strong>HilbertCurve</strong> provides three metrics for averaging.</p>
<p>The overlapping model is illustrated in following plot. The red line in the bottom represents one segment on the Hilbert curve. Black lines on the top are the parts of input intervals that overlap with the segment. The thick lines indicate the intersected part between the input intervals and the segment.</p>
<p><img src="hc_general_files/figure-html/unnamed-chunk-35-1.png" width="576" style="display: block; margin: auto;"></p>
<p>For a segment on the curve, <span class="math inline">\(n\)</span> is the number of input intervals which overlap with the segment (it is 3 in the above plot), <span class="math inline">\(w_i\)</span> is the width of the intersected segments (black thick lines), <span class="math inline">\(x_i\)</span> is the value associated with the original intervals.</p>
<p>The <strong>“absolute”</strong> method which is denoted as <span class="math inline">\(v_a\)</span> and is simple calculated as the mean regardless of the width:</p>
<p><span class="math display">\[ v_a = \frac{\sum_i^n{x_i}}{n} \]</span></p>
<p>The <strong>“weighted”</strong> method which is denoted as <span class="math inline">\(v_w\)</span> is the mean weighted by the width of intersections:</p>
<p><span class="math display">\[ v_w = \frac{\sum_i^n{x_iw_i}}{\sum_i^n{w_i}} \]</span></p>
<p>“Absolute” and “weighted” mode should be applied when background information is not of interest. E.g. when summarizing mean methylation in a small segment, since methylation is only related with CpG sites while not other bases, non-CpG background should be ignored.</p>
<p>The <strong>“w0”</strong> mode is the weighted mean between the intersected parts and un-intersected parts:</p>
<p><span class="math display">\[ v_{w0} = \frac{v_wW + v_bW'}{W+W'} \]</span></p>
<p>for which <span class="math inline">\(W\)</span> is sum of width of the intersected parts and <span class="math inline">\(W'\)</span> is the sum of width for the un-intersected parts. <span class="math inline">\(V_b\)</span> is the value corresponding to the background. E.g when averaging colors which are represented as numeric RGB values, the background value is set to 255 which corresponds to white.</p>
<p>There is one more value for <code>mean_mode</code> which is <code>max_freq</code>. <code>max_freq</code> is mainly for discrete signals and in a segment, value with the highest frequency (or with the highest length) is selected for this segment.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>This section shows several interesting examples.</p>
<p>Visualize rainbow colors:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_points-dispatch.html">hc_points</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">99</span>, x2 <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">100</span>, np <span class="op">=</span> <span class="fl">3</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">col</span>, fill <span class="op">=</span> <span class="va">col</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-36-1.png" width="576" style="display: block; margin: auto;"></p>
<p>or use the rectangles:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_rect-dispatch.html">hc_rect</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">99</span>, x2 <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">100</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">col</span>, fill <span class="op">=</span> <span class="va">col</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-37-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Reproduce <a href="http://dds.ec/hilvis/iframe.html" class="external-link">the visualization for IPv4 address</a>. The CIDR data is from <a href="http://www.iwik.org/ipcountry/" class="external-link uri">http://www.iwik.org/ipcountry/</a>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap" class="external-link">ComplexHeatmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"cidr_list.RData"</span>, package <span class="op">=</span> <span class="st">"HilbertCurve"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cidr_list</span> <span class="op">=</span> <span class="va">cidr_list</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cidr_list</span>, <span class="va">length</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span></span>
<span><span class="va">country</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cidr_list</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cidr_list</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ip</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">cidr_list</span>, <span class="st">"r"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert ip address to numbers</span></span>
<span><span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">ip</span>, <span class="st">"\\.|/"</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">start</span> <span class="op">=</span> <span class="va">mat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">256</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="va">mat</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">256</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">mat</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="fl">256</span> <span class="op">+</span> <span class="va">mat</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">width</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mat</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">32</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, base <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># top 8 countries</span></span>
<span><span class="va">col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cidr_list</span><span class="op">)</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cidr_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">top8_rate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">width</span>, <span class="va">country</span>, <span class="va">sum</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">/</span><span class="fl">256</span><span class="op">^</span><span class="fl">4</span></span>
<span><span class="va">top8</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">top8_rate</span><span class="op">)</span></span>
<span><span class="va">col</span><span class="op">[</span><span class="va">top8</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"Set1"</span><span class="op">)</span></span>
<span><span class="va">top8_rate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">top8_rate</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this is the part of using HilbertCurve package</span></span>
<span><span class="va">lgd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html" class="external-link">Legend</a></span><span class="op">(</span>at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">top8</span>, <span class="st">"Others"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">top8</span>, <span class="va">top8_rate</span><span class="op">)</span>, <span class="st">"Others"</span><span class="op">)</span>,</span>
<span>    legend_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">col</span><span class="op">[</span><span class="va">top8</span><span class="op">]</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"Top8 contries"</span><span class="op">)</span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">256</span><span class="op">^</span><span class="fl">4</span>, start_from <span class="op">=</span> <span class="st">"topleft"</span>, first_seg <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"pixel"</span>, level <span class="op">=</span> <span class="fl">9</span>, legend <span class="op">=</span> <span class="va">lgd</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_layer-dispatch.html">hc_layer</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">start</span>, x2 <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="va">width</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">[</span><span class="va">country</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Duration of Chinese dynasties. Data from <a href="http://www.360doc.com/content/11/1123/02/7829717_166641336.shtml" class="external-link uri">http://www.360doc.com/content/11/1123/02/7829717_166641336.shtml</a>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"chinese_dynasty.RData"</span>, package <span class="op">=</span> <span class="st">"HilbertCurve"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">detect_os</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'w|W'</span>, <span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">os</span> <span class="op">=</span> <span class="st">"Windows"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'darwin'</span>, <span class="va">version</span><span class="op">$</span><span class="va">os</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">os</span> <span class="op">=</span> <span class="st">"MacOS"</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="va">os</span> <span class="op">=</span> <span class="st">"Linux"</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">os</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># default font family for Chinese under different OS</span></span>
<span><span class="va">fontfamily</span> <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="fu">detect_os</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    Windows <span class="op">=</span> <span class="st">"SimSun"</span>,</span>
<span>    MacOS <span class="op">=</span> <span class="st">"Songti SC"</span>,</span>
<span>    Linux <span class="op">=</span> <span class="st">"Songti SC"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/HilbertCurve.html">HilbertCurve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    title <span class="op">=</span> <span class="st">"Chinese dynasty (1122 B.C. ~ 1911 A.D.)"</span>, </span>
<span>    title_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">16</span>, fontfamily <span class="op">=</span> <span class="va">fontfamily</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_segments-dispatch.html">hc_segments</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, x2 <span class="op">=</span> <span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, </span>
<span>    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/rand_color.html" class="external-link">rand_color</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chinese_dynasty</span><span class="op">)</span>, transparency <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, </span>
<span>        lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chinese_dynasty</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, x2 <span class="op">=</span> <span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, labels <span class="op">=</span> <span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="op">(</span><span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">chinese_dynasty</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">500</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fl">8</span>, </span>
<span>        fontfamily <span class="op">=</span> <span class="va">fontfamily</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">2000</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hc_text-dispatch.html">hc_text</a></span><span class="op">(</span><span class="va">hc</span>, x1 <span class="op">=</span> <span class="va">year</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span>, <span class="st">"BC"</span><span class="op">)</span>, <span class="va">year</span><span class="op">)</span>, </span>
<span>    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hc_general_files/figure-html/unnamed-chunk-39-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.3 (2024-02-29)</span></span>
<span><span class="co">## Platform: x86_64-apple-darwin20 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Sonoma 14.6.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Europe/Berlin</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    grid      stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] RColorBrewer_1.1-3    IRanges_2.36.0        S4Vectors_0.40.2      BiocGenerics_0.48.1  </span></span>
<span><span class="co">##  [5] ComplexHeatmap_2.18.0 HilbertVis_1.58.0     lattice_0.22-5        circlize_0.4.16      </span></span>
<span><span class="co">##  [9] HilbertCurve_1.99.0   knitr_1.45            markdown_1.12        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] shape_1.4.6.1           rjson_0.2.21            xfun_0.43               bslib_0.7.0            </span></span>
<span><span class="co">##  [5] htmlwidgets_1.6.4       GlobalOptions_0.1.2     Cairo_1.6-2             vctrs_0.6.5            </span></span>
<span><span class="co">##  [9] tools_4.3.3             bitops_1.0-7            parallel_4.3.3          highr_0.10             </span></span>
<span><span class="co">## [13] cluster_2.1.6           polylabelr_0.2.0        desc_1.4.3              lifecycle_1.0.4        </span></span>
<span><span class="co">## [17] GenomeInfoDbData_1.2.10 compiler_4.3.3          textshaping_0.3.7       codetools_0.2-19       </span></span>
<span><span class="co">## [21] clue_0.3-65             GenomeInfoDb_1.36.4     htmltools_0.5.8.1       sass_0.4.9             </span></span>
<span><span class="co">## [25] RCurl_1.98-1.14         yaml_2.3.8              pkgdown_2.0.9           crayon_1.5.2           </span></span>
<span><span class="co">## [29] jquerylib_0.1.4         cachem_1.0.8            magick_2.8.3            iterators_1.0.14       </span></span>
<span><span class="co">## [33] foreach_1.5.2           digest_0.6.35           purrr_1.0.2             fastmap_1.1.1          </span></span>
<span><span class="co">## [37] colorspace_2.1-0        cli_3.6.2               magrittr_2.0.3          rmarkdown_2.26         </span></span>
<span><span class="co">## [41] XVector_0.40.0          matrixStats_1.3.0       ragg_1.3.1              png_0.1-8              </span></span>
<span><span class="co">## [45] GetoptLong_1.0.5        memoise_2.0.1           evaluate_0.23           GenomicRanges_1.52.1   </span></span>
<span><span class="co">## [49] doParallel_1.0.17       rlang_1.1.3             Rcpp_1.0.12             jsonlite_1.8.8         </span></span>
<span><span class="co">## [53] R6_2.5.1                systemfonts_1.0.6       fs_1.6.4                zlibbioc_1.46.0</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  <style>nav[data-toggle='toc'] .nav .nav {display: block;}</style>
</body>
</html>
